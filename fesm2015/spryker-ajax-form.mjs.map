{"version":3,"file":"spryker-ajax-form.mjs","sources":["../../../../libs/ajax-form/src/lib/ajax-form/tokens.ts","../../../../libs/ajax-form/src/lib/ajax-form/ajax-form.component.ts","../../../../libs/ajax-form/src/lib/ajax-form/ajax-form.component.html","../../../../libs/ajax-form/src/lib/ajax-form.module.ts","../../../../libs/ajax-form/src/spryker-ajax-form.ts"],"sourcesContent":["import { InjectionToken } from '@angular/core';\nimport { DataSerializer } from '@spryker/data-serializer';\n\nexport const AjaxFormRequestToken = new InjectionToken<DataSerializer<FormData>>('AjaxFormRequest');\n","import { HttpClient } from '@angular/common/http';\nimport {\n    ChangeDetectionStrategy,\n    ChangeDetectorRef,\n    Component,\n    Injector,\n    Input,\n    OnChanges,\n    OnDestroy,\n    SimpleChanges,\n    ViewChild,\n    ViewContainerRef,\n    ViewEncapsulation,\n} from '@angular/core';\nimport { AjaxActionService } from '@spryker/ajax-action';\nimport { DataSerializerService } from '@spryker/data-serializer';\nimport { HtmlRendererComponent } from '@spryker/html-renderer';\nimport { Subscription } from 'rxjs';\n\nimport { AjaxFormResponse } from '../types';\nimport { AjaxFormRequestToken } from './tokens';\n\nexport interface SubmitEvent extends Event {\n    // See https://developer.mozilla.org/en-US/docs/Web/API/SubmitEvent/submitter\n    // See https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#dom-submitevent-submitter\n    submitter: HTMLElement | null;\n}\n\n@Component({\n    selector: 'spy-ajax-form',\n    templateUrl: './ajax-form.component.html',\n    styleUrls: ['./ajax-form.component.less'],\n    encapsulation: ViewEncapsulation.None,\n    changeDetection: ChangeDetectionStrategy.OnPush,\n    host: {\n        class: 'spy-ajax-form',\n    },\n})\nexport class AjaxFormComponent implements OnDestroy, OnChanges {\n    @ViewChild(HtmlRendererComponent, { read: ViewContainerRef })\n    htmlRendererVcr?: ViewContainerRef;\n\n    @Input() action?: string;\n    @Input() method = 'POST';\n\n    subscription?: Subscription;\n    submitSubscription?: Subscription;\n    ajaxFormResponse?: AjaxFormResponse;\n    isLoading = false;\n    form?: string;\n    formAction?: string;\n    formMethod?: string;\n\n    constructor(\n        private ajaxActionService: AjaxActionService,\n        private http: HttpClient,\n        private cdr: ChangeDetectorRef,\n        private injector: Injector,\n        private dataSerializerService: DataSerializerService,\n    ) {}\n\n    ngOnChanges(changes: SimpleChanges): void {\n        if ('action' in changes) {\n            this.fetchForm();\n        }\n    }\n\n    refreshForm(): void {\n        this.fetchForm();\n    }\n\n    private fetchForm(): void {\n        if (this.action) {\n            this.isLoading = true;\n\n            this.subscription = this.http.get<AjaxFormResponse>(this.action).subscribe({\n                next: (response) => this.responseHandler(response),\n                error: (response) => this.responseHandler(response),\n            });\n        }\n    }\n\n    ngOnDestroy(): void {\n        this.subscription?.unsubscribe();\n        this.submitSubscription?.unsubscribe();\n    }\n\n    submitHandler(form: HTMLFormElement, event: SubmitEvent): void {\n        event.preventDefault();\n\n        const submitElem = event.submitter;\n        const submitForm = new FormData(form);\n\n        if (submitElem) {\n            const submitName = submitElem.getAttribute('name');\n            const submitValue = submitElem.getAttribute('value') ?? '';\n\n            if (submitName) {\n                submitForm.append(submitName, submitValue);\n            }\n        }\n\n        this.isLoading = true;\n\n        if (this.action) {\n            this.submitSubscription?.unsubscribe();\n            this.submitSubscription = this.http\n                .request<AjaxFormResponse>((this.formMethod ?? this.method) || 'POST', this.formAction ?? this.action, {\n                    body: this.dataSerializerService.serialize(AjaxFormRequestToken, submitForm),\n                })\n                .subscribe({\n                    next: (response) => this.responseHandler(response),\n                    error: (response) => this.responseHandler(response),\n                });\n        }\n    }\n\n    private responseHandler(response: AjaxFormResponse): void {\n        this.ajaxFormResponse = response;\n\n        if (response.form) {\n            this.form = response.form;\n        }\n\n        this.formAction = response.action;\n        this.formMethod = response.method;\n\n        this.isLoading = false;\n        this.ajaxActionService.handle(response, this.htmlRendererVcr?.injector ?? this.injector);\n        // TODO: investigate ExpressionChangedAfterItHasBeenCheckedError\n        this.cdr.markForCheck();\n    }\n}\n","<div class=\"spy-ajax-form-container\" [class.spy-ajax-form-container--loading]=\"isLoading\">\n    <form #submitForm (submit)=\"submitHandler(submitForm, $event)\" spyUnsavedChangesFormMonitor>\n        <spy-html-renderer *ngIf=\"form\" [html]=\"form\"></spy-html-renderer>\n    </form>\n</div>\n\n<nz-spin *ngIf=\"isLoading\" class=\"spy-ajax-form-empty-state\"></nz-spin>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { AjaxFormComponent } from './ajax-form/ajax-form.component';\nimport { StaticHtmlRendererModule } from '@spryker/html-renderer';\nimport { NzSpinModule } from 'ng-zorro-antd/spin';\nimport { UnsavedChangesFormMonitorModule } from '@spryker/unsaved-changes.monitor.form';\n\n@NgModule({\n    imports: [CommonModule, StaticHtmlRendererModule, NzSpinModule, UnsavedChangesFormMonitorModule],\n    declarations: [AjaxFormComponent],\n    exports: [AjaxFormComponent],\n})\nexport class AjaxFormModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}